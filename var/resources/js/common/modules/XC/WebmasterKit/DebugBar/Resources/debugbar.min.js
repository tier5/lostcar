if(typeof PhpDebugBar=='undefined'){var PhpDebugBar={};PhpDebugBar.$=jQuery};(function($){if(typeof localStorage=='undefined')localStorage={setItem:function(key,value){},getItem:function(key){return null}};if(typeof(PhpDebugBar.utils)=='undefined')PhpDebugBar.utils={};var getDictValue=PhpDebugBar.utils.getDictValue=function(dict,key,default_value){var d=dict,parts=key.split('.');for(var i=0;i<parts.length;i++){if(!d[parts[i]])return default_value;d=d[parts[i]]};return d},getObjectSize=PhpDebugBar.utils.getObjectSize=function(obj){if(Object.keys)return Object.keys(obj).length;var count=0;for(var k in obj)if(obj.hasOwnProperty(k))count++;return count};PhpDebugBar.utils.csscls=function(cls,prefix){if(cls.indexOf(' ')>-1){var clss=cls.split(' '),out=[];for(var i=0,c=clss.length;i<c;i++)out.push(PhpDebugBar.utils.csscls(clss[i],prefix));return out.join(' ')};if(cls.indexOf('.')===0)return'.'+prefix+cls.substr(1);return prefix+cls};PhpDebugBar.utils.makecsscls=function(prefix){var f=function(cls){return PhpDebugBar.utils.csscls(cls,prefix)};return f};var csscls=PhpDebugBar.utils.makecsscls('phpdebugbar-'),Widget=PhpDebugBar.Widget=function(options){this._attributes=$.extend({},this.defaults);this._boundAttributes={};this.$el=$('<'+this.tagName+' />');if(this.className)this.$el.addClass(this.className);this.initialize.apply(this,[options||{}]);this.render.apply(this)};$.extend(Widget.prototype,{tagName:'div',className:null,defaults:{},initialize:function(options){this.set(options)},render:function(){},set:function(attr,value){if(typeof attr!='string'){for(var k in attr)this.set(k,attr[k]);return};this._attributes[attr]=value;if(typeof(this._boundAttributes[attr])!=='undefined')for(var i=0,c=this._boundAttributes[attr].length;i<c;i++)this._boundAttributes[attr][i].apply(this,[value])},has:function(attr){return typeof(this._attributes[attr])!=='undefined'&&this._attributes[attr]!==null},get:function(attr){return this._attributes[attr]},bindAttr:function(attr,cb){if($.isArray(attr)){for(var i=0,c=attr.length;i<c;i++)this.bindAttr(attr[i],cb);return};if(typeof(this._boundAttributes[attr])=='undefined')this._boundAttributes[attr]=[];if(typeof cb=='object'){var el=cb;cb=function(value){el.text(value||'')}};this._boundAttributes[attr].push(cb);if(this.has(attr))cb.apply(this,[this._attributes[attr]])}});Widget.extend=function(props){var parent=this,child=function(){return parent.apply(this,arguments)};$.extend(child,parent);var Surrogate=function(){this.constructor=child};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate();$.extend(child.prototype,props);child.__super__=parent.prototype;return child};var Tab=Widget.extend({className:csscls('panel'),render:function(){this.$tab=$('<a />').addClass(csscls('tab'));this.$icon=$('<i />').appendTo(this.$tab);this.bindAttr('icon',function(icon){if(icon){this.$icon.attr('class','phpdebugbar-fa phpdebugbar-fa-'+icon)}else this.$icon.attr('class','')});this.bindAttr('title',$('<span />').addClass(csscls('text')).appendTo(this.$tab));this.$badge=$('<span />').addClass(csscls('badge')).appendTo(this.$tab);this.bindAttr('badge',function(value){if(value!==null){this.$badge.text(value);this.$badge.show()}else this.$badge.hide()});this.bindAttr('widget',function(widget){this.$el.empty().append(widget.$el)});this.bindAttr('data',function(data){if(this.has('widget'))this.get('widget').set('data',data)})}}),Indicator=Widget.extend({tagName:'span',className:csscls('indicator'),render:function(){this.$icon=$('<i />').appendTo(this.$el);this.bindAttr('icon',function(icon){if(icon){this.$icon.attr('class','phpdebugbar-fa phpdebugbar-fa-'+icon)}else this.$icon.attr('class','')});this.bindAttr(['title','data'],$('<span />').addClass(csscls('text')).appendTo(this.$el));this.$tooltip=$('<span />').addClass(csscls('tooltip disabled')).appendTo(this.$el);this.bindAttr('tooltip',function(tooltip){if(tooltip){this.$tooltip.text(tooltip).removeClass(csscls('disabled'))}else this.$tooltip.addClass(csscls('disabled'))})}}),DatasetTitleFormater=PhpDebugBar.DatasetTitleFormater=function(debugbar){this.debugbar=debugbar};$.extend(DatasetTitleFormater.prototype,{format:function(id,data,suffix){if(suffix){suffix=' '+suffix}else suffix='';var nb=getObjectSize(this.debugbar.datasets)+1;if(typeof(data.__meta)==='undefined')return"#"+nb+suffix;var filename=data.__meta['uri'].substr(data.__meta['uri'].lastIndexOf('/')+1),label="#"+nb+" "+filename+suffix+' ('+data.__meta['datetime'].split(' ')[1]+')';return label}});var DebugBar=PhpDebugBar.DebugBar=Widget.extend({className:"phpdebugbar "+csscls('minimized'),options:{bodyPaddingBottom:true},initialize:function(){this.controls={};this.dataMap={};this.datasets={};this.firstTabName=null;this.activePanelName=null;this.datesetTitleFormater=new DatasetTitleFormater(this);this.registerResizeHandler()},registerResizeHandler:function(){if(typeof this.resize.bind=='undefined')return;var f=this.resize.bind(this);this.respCSSSize=0;$(window).resize(f);setTimeout(f,20)},resize:function(){var contentSize=this.respCSSSize;if(this.respCSSSize==0)this.$header.find("> div > *:visible").each(function(){contentSize+=$(this).outerWidth()});var currentSize=this.$header.width(),cssClass="phpdebugbar-mini-design",bool=this.$header.hasClass(cssClass);if(currentSize<=contentSize&&!bool){this.respCSSSize=contentSize;this.$header.addClass(cssClass)}else if(contentSize<currentSize&&bool){this.respCSSSize=0;this.$header.removeClass(cssClass)};this.setHeight(this.$body.height())},render:function(){var self=this;this.$el.appendTo('body');this.$dragCapture=$('<div />').addClass(csscls('drag-capture')).appendTo(this.$el);this.$resizehdle=$('<div />').addClass(csscls('resize-handle')).appendTo(this.$el);this.$header=$('<div />').addClass(csscls('header')).appendTo(this.$el);this.$headerLeft=$('<div />').addClass(csscls('header-left')).appendTo(this.$header);this.$headerRight=$('<div />').addClass(csscls('header-right')).appendTo(this.$header);var $body=this.$body=$('<div />').addClass(csscls('body')).appendTo(this.$el);this.recomputeBottomOffset();var pos_y,orig_h;this.$resizehdle.on('mousedown',function(e){orig_h=$body.height(),pos_y=e.pageY;$body.parents().on('mousemove',mousemove).on('mouseup',mouseup);self.$dragCapture.show();e.preventDefault()});var mousemove=function(e){var h=orig_h+(pos_y-e.pageY);self.setHeight(h)},mouseup=function(){$body.parents().off('mousemove',mousemove).off('mouseup',mouseup);self.$dragCapture.hide()};this.$closebtn=$('<a />').addClass(csscls('close-btn')).appendTo(this.$headerRight);this.$closebtn.click(function(){self.close()});this.$minimizebtn=$('<a />').addClass(csscls('minimize-btn')).appendTo(this.$headerRight);this.$minimizebtn.click(function(){self.minimize()});this.$maximizebtn=$('<a />').addClass(csscls('maximize-btn')).appendTo(this.$headerRight);this.$maximizebtn.click(function(){self.restore()});this.$restorebtn=$('<a />').addClass(csscls('restore-btn')).hide().appendTo(this.$el);this.$restorebtn.click(function(){self.restore()});this.$openbtn=$('<a />').addClass(csscls('open-btn')).appendTo(this.$headerRight).hide();this.$openbtn.click(function(){self.openHandler.show(function(id,dataset){self.addDataSet(dataset,id,"(opened)");self.showTab()})});this.$datasets=$('<select />').addClass(csscls('datasets-switcher')).appendTo(this.$headerRight);this.$datasets.change(function(){self.dataChangeHandler(self.datasets[this.value]);self.showTab()})},setHeight:function(height){var min_h=40,max_h=$(window).innerHeight()-this.$header.height()-10;height=Math.min(height,max_h);height=Math.max(height,min_h);this.$body.css('height',height);localStorage.setItem('phpdebugbar-height',height);this.recomputeBottomOffset()},restoreState:function(){var height=localStorage.getItem('phpdebugbar-height');this.setHeight(height||this.$body.height());var open=localStorage.getItem('phpdebugbar-open');if(open&&open=='0'){this.close()}else{var visible=localStorage.getItem('phpdebugbar-visible');if(visible&&visible=='1'){var tab=localStorage.getItem('phpdebugbar-tab');if(this.isTab(tab))this.showTab(tab)}}},createTab:function(name,widget,title){var tab=new Tab({title:title||(name.replace(/[_\-]/g,' ').charAt(0).toUpperCase()+name.slice(1)),widget:widget});return this.addTab(name,tab)},addTab:function(name,tab){if(this.isControl(name))throw new Error(name+' already exists');var self=this;tab.$tab.appendTo(this.$headerLeft).click(function(){if(!self.isMinimized()&&self.activePanelName==name){self.minimize()}else self.showTab(name)});tab.$el.appendTo(this.$body);this.controls[name]=tab;if(this.firstTabName==null)this.firstTabName=name;return tab},createIndicator:function(name,icon,tooltip,position){var indicator=new Indicator({icon:icon,tooltip:tooltip});return this.addIndicator(name,indicator,position)},addIndicator:function(name,indicator,position){if(this.isControl(name))throw new Error(name+' already exists');if(position=='left'){indicator.$el.insertBefore(this.$headerLeft.children().first())}else indicator.$el.appendTo(this.$headerRight);this.controls[name]=indicator;return indicator},getControl:function(name){if(this.isControl(name))return this.controls[name]},isControl:function(name){return typeof(this.controls[name])!='undefined'},isTab:function(name){return this.isControl(name)&&this.controls[name]instanceof Tab},isIndicator:function(name){return this.isControl(name)&&this.controls[name]instanceof Indicator},reset:function(){this.minimize();var self=this;$.each(this.controls,function(name,control){if(self.isTab(name))control.$tab.remove();control.$el.remove()});this.controls={}},showTab:function(name){if(!name)if(this.activePanelName){name=this.activePanelName}else name=this.firstTabName;if(!this.isTab(name))throw new Error("Unknown tab '"+name+"'");this.$resizehdle.show();this.$body.show();this.recomputeBottomOffset();$(this.$header).find('> div > .'+csscls('active')).removeClass(csscls('active'));$(this.$body).find('> .'+csscls('active')).removeClass(csscls('active'));this.controls[name].$tab.addClass(csscls('active'));this.controls[name].$el.addClass(csscls('active'));this.activePanelName=name;this.$el.removeClass(csscls('minimized'));localStorage.setItem('phpdebugbar-visible','1');localStorage.setItem('phpdebugbar-tab',name);this.resize()},minimize:function(){this.$header.find('> div > .'+csscls('active')).removeClass(csscls('active'));this.$body.hide();this.$resizehdle.hide();this.recomputeBottomOffset();localStorage.setItem('phpdebugbar-visible','0');this.$el.addClass(csscls('minimized'));this.resize()},isMinimized:function(){return this.$el.hasClass(csscls('minimized'))},close:function(){this.$resizehdle.hide();this.$header.hide();this.$body.hide();this.$restorebtn.show();localStorage.setItem('phpdebugbar-open','0');this.$el.addClass(csscls('closed'));this.recomputeBottomOffset()},restore:function(){this.$resizehdle.show();this.$header.show();this.$restorebtn.hide();localStorage.setItem('phpdebugbar-open','1');var tab=localStorage.getItem('phpdebugbar-tab');if(this.isTab(tab))this.showTab(tab);this.$el.removeClass(csscls('closed'));this.resize()},recomputeBottomOffset:function(){if(this.options.bodyPaddingBottom)$('body').css('padding-bottom',this.$el.height())},setDataMap:function(map){this.dataMap=map},addDataMap:function(map){$.extend(this.dataMap,map)},setData:function(data){this.datasets={};return this.addDataSet(data)},addDataSet:function(data,id,suffix){var label=this.datesetTitleFormater.format(id,data,suffix);id=id||(getObjectSize(this.datasets)+1);this.datasets[id]=data;this.$datasets.append($('<option value="'+id+'">'+label+'</option>'));if(this.$datasets.children().length>1)this.$datasets.show();this.showDataSet(id);return id},loadDataSet:function(id,suffix,callback){if(!this.openHandler)throw new Error('loadDataSet() needs an open handler');var self=this;this.openHandler.load(id,function(data){self.addDataSet(data,id,suffix);callback&&callback(data)})},getDataSet:function(id){return this.datasets[id]},showDataSet:function(id){this.dataChangeHandler(this.datasets[id]);this.$datasets.val(id)},dataChangeHandler:function(data){var self=this;$.each(this.dataMap,function(key,def){var d=getDictValue(data,def[0],def[1]);if(key.indexOf(':')!=-1){key=key.split(':');self.getControl(key[0]).set(key[1],d)}else self.getControl(key).set('data',d)})},setOpenHandler:function(handler){this.openHandler=handler;if(handler!==null){this.$openbtn.show()}else this.$openbtn.hide()},getOpenHandler:function(){return this.openHandler}});DebugBar.Tab=Tab;DebugBar.Indicator=Indicator;var AjaxHandler=PhpDebugBar.AjaxHandler=function(debugbar,headerName){this.debugbar=debugbar;this.headerName=headerName||'phpdebugbar'};$.extend(AjaxHandler.prototype,{handle:function(xhr){if(!this.loadFromId(xhr))return this.loadFromData(xhr);return true},loadFromId:function(xhr){var id=this.extractIdFromHeaders(xhr);if(id&&this.debugbar.openHandler){this.debugbar.loadDataSet(id,"(ajax)");return true};return false},extractIdFromHeaders:function(xhr){return xhr.getResponseHeader(this.headerName+'-id')},loadFromData:function(xhr){var raw=this.extractDataFromHeaders(xhr);if(!raw)return false;var data=this.parseHeaders(raw);if(data.error){throw new Error('Error loading debugbar data: '+data.error)}else if(data.data)this.debugbar.addDataSet(data.data,data.id,"(ajax)");return true},extractDataFromHeaders:function(xhr){var data=xhr.getResponseHeader(this.headerName);if(!data)return;for(var i=1;;i++){var header=xhr.getResponseHeader(this.headerName+'-'+i);if(!header)break;data+=header};return decodeURIComponent(data)},parseHeaders:function(data){return JSON.parse(data)},bindToJquery:function(jq){var self=this;jq(document).ajaxComplete(function(e,xhr,settings){if(!settings.ignoreDebugBarAjaxHandler)self.handle(xhr)})},bindToXHR:function(){var self=this,proxied=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(method,url,async,user,pass){var xhr=this;this.addEventListener("readystatechange",function(){var skipUrl=self.debugbar.openHandler?self.debugbar.openHandler.get('url'):null;if(xhr.readyState==4&&url.indexOf(skipUrl)!==0)self.handle(xhr)},false);proxied.apply(this,Array.prototype.slice.call(arguments))}}})})(PhpDebugBar.$)